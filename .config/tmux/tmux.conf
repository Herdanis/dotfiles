# ============================================================================
# Tmux Configuration
# ============================================================================
# Tmux: Terminal multiplexer for managing multiple terminal sessions
# Allows splitting windows, session persistence, and remote attachment
#
# Key Concepts:
#   - Session: Collection of windows (like a workspace)
#   - Window: Collection of panes (like a tab)
#   - Pane: Individual terminal within a window (like a split)
#
# Prefix Key (macOS): Alt/Option + Space (M-Space)
# Common Commands:
#   prefix + c       - Create new window
#   prefix + |       - Horizontal split (custom binding)
#   prefix + "       - Vertical split
#   prefix + h/j/k/l - Navigate panes (Vim-style)
#   prefix + r       - Reload this config file
#   prefix + [       - Enter copy mode (use vi keybindings)
#   prefix + d       - Detach from session
#
# Session Management:
#   tmux new -s name    - Create new session
#   tmux attach -t name - Attach to session
#   tmux ls             - List sessions
#   tmux kill-session   - Kill session
#
# Documentation: man tmux
# Plugin Manager (TPM): https://github.com/tmux-plugins/tpm
# ============================================================================

# ----------------------------------------------------------------------------
# Config Reload Keybinding
# ----------------------------------------------------------------------------
# Unbind default reload key and set custom reload
# Usage: prefix + r to reload configuration
unbind r
bind r source-file ~/.config/tmux/tmux.conf

# ----------------------------------------------------------------------------
# Prefix Key Configuration (macOS Only)
# ----------------------------------------------------------------------------
# Change prefix from Ctrl+b to Alt+Space (easier to reach)
# Only applies on macOS (Darwin)
if-shell "uname | grep -q Darwin" {
    unbind C-b
    set -g prefix M-Space        # Alt/Option + Space as prefix
    bind Space send-prefix       # Send literal Space when needed
}

# ============================================================================
# General Settings
# ============================================================================

# Enable mouse support (click to select pane, resize, scroll)
set -g mouse on

# Set terminal type for proper color support
set -g default-terminal "tmux-256color"

# Reduce escape time (improves Vim/Neovim responsiveness)
set -sg escape-time 10

# Set Fish as default shell (both command and shell)
set -g default-command /opt/homebrew/bin/fish
set -g default-shell /opt/homebrew/bin/fish

# Enable cursor shape changes (for Vim mode indicators)
set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# ============================================================================
# Pane Navigation & Management
# ============================================================================

# ----------------------------------------------------------------------------
# Vim-style Pane Navigation
# ----------------------------------------------------------------------------
# Navigate between panes using Vim hjkl keys (without prefix needed via plugin)
bind-key h select-pane -L   # Move to left pane
bind-key j select-pane -D   # Move to pane below
bind-key k select-pane -U   # Move to pane above
bind-key l select-pane -R   # Move to right pane

# ----------------------------------------------------------------------------
# Window Swapping
# ----------------------------------------------------------------------------
# Move current window left/right in window list
bind-key H swap-window -t -1   # Move window left
bind-key L swap-window -t +1   # Move window right

# ----------------------------------------------------------------------------
# Pane Splitting
# ----------------------------------------------------------------------------
# Custom horizontal split (small bottom pane for commands)
bind-key '|' split-window -v -l 10 -c "#{pane_current_path}"

# Allow Ctrl+l to clear screen (tmux-navigator compatibility)
bind C-l send-keys 'C-l'

# ============================================================================
# Status Bar & Visual Settings
# ============================================================================

# Position status bar at top of terminal
set-option -g status-position top

# Use vi-style keybindings in copy mode
setw -g mode-keys vi

# ============================================================================
# Copy Mode Configuration (Vi-style)
# ============================================================================
# Copy mode allows scrolling and text selection with vi keybindings
# Enter copy mode: prefix + [
# Exit copy mode: q or Escape

# Start visual selection with 'v' (like Vim visual mode)
bind -T copy-mode-vi v send -X begin-selection

# Yank (copy) selection with 'y' and copy to system clipboard (macOS)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Paste from tmux buffer
bind P paste-buffer

# Copy mouse selection to system clipboard (macOS)
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Alternative yank binding (copy and exit copy mode)
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# Mouse drag selection copies to clipboard
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel

# ============================================================================
# Plugin Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# TPM (Tmux Plugin Manager) Plugins
# ----------------------------------------------------------------------------
# Install plugins: prefix + I (capital i)
# Update plugins: prefix + U
# Remove plugins: prefix + alt + u

set -g @plugin 'tmux-plugins/tpm'                    # Plugin manager itself
set -g @plugin 'tmux-plugins/tmux-sensible'          # Sensible defaults
set -g @plugin 'catppuccin/tmux#v2.1.3'             # Catppuccin theme
set -g @plugin 'christoomey/vim-tmux-navigator'      # Seamless Vim/Tmux navigation
set -g @plugin 'tmux-plugins/tmux-resurrect'         # Save/restore sessions
set -g @plugin 'jaclu/tmux-menus'                    # Interactive menu system

# Set plugin installation directory
setenv -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.config/tmux/plugins/"

# ----------------------------------------------------------------------------
# Window/Pane Creation in Current Directory
# ----------------------------------------------------------------------------
# Override default bindings to open new windows/panes in current directory
bind C-c new-window -c "#{pane_current_path}"         # New window in current dir
bind '"' split-window -c "#{pane_current_path}"       # Vertical split in current dir
bind % split-window -h -c "#{pane_current_path}"      # Horizontal split in current dir

# ============================================================================
# Catppuccin Theme Configuration
# ============================================================================
# Catppuccin: Soothing pastel theme for Tmux
# Plugin: https://github.com/catppuccin/tmux
#
# Available Flavors: latte (light), frappe, macchiato, mocha (darkest)
# ============================================================================

# ----------------------------------------------------------------------------
# Theme Flavor Selection
# ----------------------------------------------------------------------------
set -g @catppuccin_flavor 'mocha'  # Options: latte, frappe, macchiato, mocha
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_number_position "left"

set -g @catppuccin_window_text " #W"

set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text " #W"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "yes"

# # set -g @catppuccin_status_background "#1f2329"
# set -gF mode-style "bg=#{@thm_yellow},bold"
# set -gF clock-mode-colour "#{@thm_yellow}"

set -g @catppuccin_directory_text "#{pane_current_path}"

# Run catppuccin plugin manually or through tpm
# ...

set -g status-left " "
set -g status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_user}"
# set -ag status-right "#{E:@catppuccin_status_host}"

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
